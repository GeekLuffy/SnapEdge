{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///F:/SnapEdge/src/lib/telegram.ts"],"sourcesContent":["export interface TelegramFileResult {\r\n  file_id: string;\r\n  file_unique_id: string;\r\n  file_path?: string;\r\n}\r\n\r\nexport async function uploadToTelegram(file: Blob, fileName: string): Promise<TelegramFileResult> {\r\n  const token = process.env.TELEGRAM_BOT_TOKEN;\r\n  const chatId = process.env.TELEGRAM_CHAT_ID;\r\n\r\n  if (!token || !chatId) {\r\n    throw new Error('Telegram credentials not configured');\r\n  }\r\n\r\n  const formData = new FormData();\r\n  formData.append('chat_id', chatId);\r\n  formData.append('photo', file, fileName);\r\n\r\n  const response = await fetch(`https://api.telegram.org/bot${token}/sendPhoto`, {\r\n    method: 'POST',\r\n    body: formData,\r\n  });\r\n\r\n  const data = await response.json();\r\n\r\n  if (!data.ok) {\r\n    throw new Error(`Telegram API error: ${data.description}`);\r\n  }\r\n\r\n  // Telegram returns an array of sizes, we take the largest one\r\n  const photos = data.result.photo;\r\n  const largestPhoto = photos[photos.length - 1];\r\n\r\n  return {\r\n    file_id: largestPhoto.file_id,\r\n    file_unique_id: largestPhoto.file_unique_id,\r\n  };\r\n}\r\n\r\nexport async function getTelegramFileUrl(fileId: string): Promise<string> {\r\n  const token = process.env.TELEGRAM_BOT_TOKEN;\r\n\r\n  if (!token) {\r\n    throw new Error('Telegram token not configured');\r\n  }\r\n\r\n  const response = await fetch(`https://api.telegram.org/bot${token}/getFile?file_id=${fileId}`);\r\n  const data = await response.json();\r\n\r\n  if (!data.ok) {\r\n    throw new Error(`Telegram API error: ${data.description}`);\r\n  }\r\n\r\n  const filePath = data.result.file_path;\r\n  return `https://api.telegram.org/file/bot${token}/${filePath}`;\r\n}\r\n"],"names":[],"mappings":";;;;;;AAMO,eAAe,iBAAiB,IAAU,EAAE,QAAgB;IACjE,MAAM,QAAQ,QAAQ,GAAG,CAAC,kBAAkB;IAC5C,MAAM,SAAS,QAAQ,GAAG,CAAC,gBAAgB;IAE3C,IAAI,CAAC,SAAS,CAAC,QAAQ;QACrB,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,WAAW,IAAI;IACrB,SAAS,MAAM,CAAC,WAAW;IAC3B,SAAS,MAAM,CAAC,SAAS,MAAM;IAE/B,MAAM,WAAW,MAAM,MAAM,CAAC,4BAA4B,EAAE,MAAM,UAAU,CAAC,EAAE;QAC7E,QAAQ;QACR,MAAM;IACR;IAEA,MAAM,OAAO,MAAM,SAAS,IAAI;IAEhC,IAAI,CAAC,KAAK,EAAE,EAAE;QACZ,MAAM,IAAI,MAAM,CAAC,oBAAoB,EAAE,KAAK,WAAW,EAAE;IAC3D;IAEA,8DAA8D;IAC9D,MAAM,SAAS,KAAK,MAAM,CAAC,KAAK;IAChC,MAAM,eAAe,MAAM,CAAC,OAAO,MAAM,GAAG,EAAE;IAE9C,OAAO;QACL,SAAS,aAAa,OAAO;QAC7B,gBAAgB,aAAa,cAAc;IAC7C;AACF;AAEO,eAAe,mBAAmB,MAAc;IACrD,MAAM,QAAQ,QAAQ,GAAG,CAAC,kBAAkB;IAE5C,IAAI,CAAC,OAAO;QACV,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,WAAW,MAAM,MAAM,CAAC,4BAA4B,EAAE,MAAM,iBAAiB,EAAE,QAAQ;IAC7F,MAAM,OAAO,MAAM,SAAS,IAAI;IAEhC,IAAI,CAAC,KAAK,EAAE,EAAE;QACZ,MAAM,IAAI,MAAM,CAAC,oBAAoB,EAAE,KAAK,WAAW,EAAE;IAC3D;IAEA,MAAM,WAAW,KAAK,MAAM,CAAC,SAAS;IACtC,OAAO,CAAC,iCAAiC,EAAE,MAAM,CAAC,EAAE,UAAU;AAChE"}},
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///F:/SnapEdge/src/lib/db.ts"],"sourcesContent":["import fs from 'fs/promises';\r\nimport path from 'path';\r\n\r\nconst DB_PATH = path.join(process.cwd(), 'db.json');\r\n\r\nexport interface ImageRecord {\r\n    id: string; // Clean ID used in URL\r\n    telegram_file_id: string;\r\n    created_at: number;\r\n}\r\n\r\nasync function ensureDb() {\r\n    try {\r\n        await fs.access(DB_PATH);\r\n    } catch {\r\n        await fs.writeFile(DB_PATH, JSON.stringify({ images: [] }));\r\n    }\r\n}\r\n\r\nexport async function saveImage(record: ImageRecord) {\r\n    await ensureDb();\r\n    const content = await fs.readFile(DB_PATH, 'utf-8');\r\n    const db = JSON.parse(content);\r\n    db.images.push(record);\r\n    await fs.writeFile(DB_PATH, JSON.stringify(db, null, 2));\r\n}\r\n\r\nexport async function getImage(id: string): Promise<ImageRecord | null> {\r\n    await ensureDb();\r\n    const content = await fs.readFile(DB_PATH, 'utf-8');\r\n    const db = JSON.parse(content);\r\n    return db.images.find((img: ImageRecord) => img.id === id) || null;\r\n}\r\n\r\nexport function generateId() {\r\n    return Math.random().toString(36).substring(2, 10);\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;;;AAEA,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AAQzC,eAAe;IACX,IAAI;QACA,MAAM,gIAAE,CAAC,MAAM,CAAC;IACpB,EAAE,OAAM;QACJ,MAAM,gIAAE,CAAC,SAAS,CAAC,SAAS,KAAK,SAAS,CAAC;YAAE,QAAQ,EAAE;QAAC;IAC5D;AACJ;AAEO,eAAe,UAAU,MAAmB;IAC/C,MAAM;IACN,MAAM,UAAU,MAAM,gIAAE,CAAC,QAAQ,CAAC,SAAS;IAC3C,MAAM,KAAK,KAAK,KAAK,CAAC;IACtB,GAAG,MAAM,CAAC,IAAI,CAAC;IACf,MAAM,gIAAE,CAAC,SAAS,CAAC,SAAS,KAAK,SAAS,CAAC,IAAI,MAAM;AACzD;AAEO,eAAe,SAAS,EAAU;IACrC,MAAM;IACN,MAAM,UAAU,MAAM,gIAAE,CAAC,QAAQ,CAAC,SAAS;IAC3C,MAAM,KAAK,KAAK,KAAK,CAAC;IACtB,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC,MAAqB,IAAI,EAAE,KAAK,OAAO;AAClE;AAEO,SAAS;IACZ,OAAO,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,GAAG;AACnD"}},
    {"offset": {"line": 148, "column": 0}, "map": {"version":3,"sources":["file:///F:/SnapEdge/src/app/api/upload/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { uploadToTelegram } from '@/lib/telegram';\r\nimport { saveImage, generateId } from '@/lib/db';\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        const formData = await req.formData();\r\n        const file = formData.get('file') as Blob;\r\n\r\n        if (!file) {\r\n            return NextResponse.json({ error: 'No file provided' }, { status: 400 });\r\n        }\r\n\r\n        // 1. Upload to Telegram\r\n        const telegramResult = await uploadToTelegram(file, 'upload.jpg');\r\n\r\n        // 2. Generate custom ID and save to DB\r\n        const id = generateId();\r\n        await saveImage({\r\n            id,\r\n            telegram_file_id: telegramResult.file_id,\r\n            created_at: Date.now(),\r\n        });\r\n\r\n        const baseUrl = process.env.NEXT_PUBLIC_BASE_URL ||\r\n            (req.headers.get('host') ? `http://${req.headers.get('host')}` : '');\r\n\r\n        return NextResponse.json({\r\n            id,\r\n            url: `${baseUrl}/i/${id}`\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error('Upload error:', error);\r\n        return NextResponse.json({ error: error.message || 'Internal server error' }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,GAAgB;IACvC,IAAI;QACA,MAAM,WAAW,MAAM,IAAI,QAAQ;QACnC,MAAM,OAAO,SAAS,GAAG,CAAC;QAE1B,IAAI,CAAC,MAAM;YACP,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QAC1E;QAEA,wBAAwB;QACxB,MAAM,iBAAiB,MAAM,IAAA,4IAAgB,EAAC,MAAM;QAEpD,uCAAuC;QACvC,MAAM,KAAK,IAAA,gIAAU;QACrB,MAAM,IAAA,+HAAS,EAAC;YACZ;YACA,kBAAkB,eAAe,OAAO;YACxC,YAAY,KAAK,GAAG;QACxB;QAEA,MAAM,UAAU,6DACZ,CAAC,IAAI,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC,OAAO,EAAE,IAAI,OAAO,CAAC,GAAG,CAAC,SAAS,GAAG,EAAE;QAEvE,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB;YACA,KAAK,GAAG,QAAQ,GAAG,EAAE,IAAI;QAC7B;IAEJ,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO,IAAI;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAChG;AACJ"}}]
}